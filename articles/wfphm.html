<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Waterfall plus heatmap module • dv.explorer.parameter</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Waterfall plus heatmap module">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="inverse" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dv.explorer.parameter</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/boxplot.html">Boxplot module</a></li>
    <li><a class="dropdown-item" href="../articles/correlation_heatmap.html">Correlation heatmap module</a></li>
    <li><a class="dropdown-item" href="../articles/forest.html">Forest plot module</a></li>
    <li><a class="dropdown-item" href="../articles/lineplot_main_article.html">Lineplot module</a></li>
    <li><a class="dropdown-item" href="../articles/lineplot_reference_values.html">Lineplot reference values</a></li>
    <li><a class="dropdown-item" href="../articles/qc.html">Quality Control</a></li>
    <li><a class="dropdown-item" href="../articles/roc.html">ROC</a></li>
    <li><a class="dropdown-item" href="../articles/scatterplot.html">Scatterplot module</a></li>
    <li><a class="dropdown-item" href="../articles/scatterplotmatrix.html">Matrix of Scatterplots module</a></li>
    <li><a class="dropdown-item" href="../articles/wfphm.html">Waterfall plus heatmap module</a></li>
    <li><a class="dropdown-item" href="../articles/zz_buildinfo.html">Build Info</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/qc.html">Quality Control</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="wfphm_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="wfphm_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="wfphm_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="wfphm_files/datatables-binding-0.33/datatables.js"></script><link href="wfphm_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="wfphm_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="wfphm_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="wfphm_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="wfphm_files/crosstalk-1.2.1/js/crosstalk.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Waterfall plus heatmap module</h1>
            
      

      <div class="d-none name"><code>wfphm.Rmd</code></div>
    </div>

    
    
<p><img src="images%2Fwfphm_app.png"></p>
<p>This guide provides a detailed overview of the <strong>Waterfall plus
Heatmap (WfpHm)</strong> module and its features. It is meant to provide
guidance to App Creators on creating Apps in DaVinci using the WfpHm
module. Walk-throughs for sample app creation using the module are also
included to demonstrate the various module specific features.</p>
<p>The <strong>WfpHm</strong> module makes it possible to visualize an
appropriate variable of choice in a waterfall plot(bar chart sorted in
descending order of the visualized variable from left to right) and
simultaneously visualize one or more additional variables in different
heat-maps that share the same common X-Axis with the Waterfall plot.
This allows a user to find relations between the variables represented
in the waterfall plot and the heatmaps to look for patterns.</p>
<div class="section level4">
<h4 id="pre-requisite">Pre-requisite:<a class="anchor" aria-label="anchor" href="#pre-requisite"></a>
</h4>
<p><br></p>
<div style="padding: 1em 1em 1em 1em;  margin-bottom: 5px;  border: 1px solid #64a1ce;  border-radius: 5px;  background:#f5f5f5 5px center/3em no-repeat;">
<p><img src="images%2Finfo.png" style="width:4.0%"><strong>“Parameter”
Term Disambiguation</strong></p>
<p>The guide uses the term <strong>“parameter”</strong> at several
places. This term in the guide represents clinical analysis parameters
and values such as laboratory values, safety values, etc as used in the
clinical dataset context. This can be confused with the word parameter
as used in a programming context - “parameters of a function”.
Therefore, to fully disambiguate the usage in this guide:</p>
<ul>
<li>
<strong>Parameter</strong> is used exclusively in the clinical
dataset context</li>
<li>
<strong>Argument</strong> is used to represent parameter of a
function in the programming context</li>
</ul>
</div>
<p><br></p>
</div>
<div class="section level2">
<h2 id="features">Features<a class="anchor" aria-label="anchor" href="#features"></a>
</h2>
<p>WfpHm features the following four different plots:</p>
<ul>
<li>A waterfall plot</li>
<li>A categorical heatmap</li>
<li>A continuous heatmap</li>
<li>A parameter heatmap</li>
</ul>
<p>The intended usage of the plot is to find relations between a
variable represented in the waterfall plot and the heatmaps.</p>
<p>The main feature of the module is the order of the variable values in
the <strong>X</strong> axis which is common and shared across all plots.
The order is determined based on the variable visualized in the
waterfall plot starting from left with the one having the largest value
for the variable in the waterfall plot. The variable on the X-Axis is
based on the value specified for the “<code>subjid_var"</code> argument
for the module. Typically it is expected to be”Subject ID” and hence the
naming convention for the argument reflects this and the default value
for the argument is set to “SUBJID”. However please note that the module
will support other suitable variables on the X-Axis as well if it is
specified as the argument value.</p>
<p>The variable visualized in the waterfall plot can be changed
dynamically as the module allows the user to select it from the
available variables in the dataset. By selecting different variables one
can observe if the rest of the plots follow a particular pattern.</p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="mandatory-arguments-for-the-module">Mandatory Arguments for the module<a class="anchor" aria-label="anchor" href="#mandatory-arguments-for-the-module"></a>
</h2>
<p>[dv.explorer.parameter::mod_wfphm()] module uses several arguments
with the following two being mandatory and the rest optional. Some of
the optional As part of app creation, the app creator should specify the
values for these arguments as applicable.</p>
<p><strong>Mandatory Arguments</strong></p>
<ul>
<li><p><code>module_id</code> : A unique identifier of type character
for the module in the app.</p></li>
<li>
<p><code>bm_dataset_name</code> : The name of dataset contains the
variables to be displayed on the waterfall and parameter heatmap plots
in the WfpHm module. The dataset should at least have the columns with
names specified for the <em>cat_var</em>, <em>par_var</em>,
<em>value_vars</em>, <em>visit_var</em> and <em>subjid_var</em> optional
arguments. The default values for these optional arguments if not
specified are defined below.</p>
<ul>
<li>
<code>cat_var</code>: “PARCAT1”</li>
<li>
<code>par_var</code>: “PARAM”</li>
<li>
<code>value_vars</code>: One or more columns with names “AVAL” or
“CHG” or “PCHG” or “log2AVAL” or “log2CHG” or “log2PCHG” or “log10AVAL”
or “log10CHG”, “log10PCHG”</li>
<li>
<code>visit_var</code>: “AVISIT”</li>
<li>
<code>subjid_var</code>: “SUBJID”</li>
</ul>
</li>
<li>
<p><code>group_dataset_name</code> : The name of dataset used to
define groups in the waterfall plot and the variables to be displayed in
the continuous and categorical heatmaps.</p>
<p>The dataset should at least have the columns with names:</p>
<ul>
<li>
<code>subjid_var</code>: “SUBJID”</li>
</ul>
</li>
</ul>
<p>Refer to <code><a href="../reference/wfphm.html">dv.explorer.parameter::mod_wfphm()</a></code> for the
complete list of arguments and their description.</p>
</div>
<div class="section level2">
<h2 id="input-dataset">Input dataset<a class="anchor" aria-label="anchor" href="#input-dataset"></a>
</h2>
<p>The <code>mod_wfphm</code> module is designed to work with <a href="https://www.cdisc.org/kb/examples/adam-basic-data-structure-bds-using-paramcd-80288192" class="external-link">ADaM
Basic Data Structure (BDS) using PARAMCD</a>. The default values of
arguments for the module matches the naming of this standard
dataset.</p>
<p>Nonetheless:</p>
<ul>
<li>Other names can also be specified in the arguments of the module. So
the module can work with other datasets with similar data structures but
having different names.</li>
<li>Not all columns in the mentioned data structure are compulsory.
Refer to the “Mandatory Arguments” section above for details on the
columns that are compulsory.</li>
</ul>
<div class="section level3">
<h3 id="example-dataset">Example dataset<a class="anchor" aria-label="anchor" href="#example-dataset"></a>
</h3>
<p>We will be using a simple dataset defined below for most of our
examples to illustrate the basic features of the module. More complex
ones will be created in the later part of the guide to describe
additional features of the module.</p>
<p>This example datasets includes only a subset of the columns from the
ADaM standard dataset mentioned above.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"adbm"</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    SUBJID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    PARCAT1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC1"</span>, <span class="st">"PC2"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    PARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P1"</span>, <span class="st">"P2"</span>, <span class="st">"P1"</span>, <span class="st">"P2"</span>, <span class="st">"P1"</span>, <span class="st">"P2"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    AVISIT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"V1"</span>, <span class="st">"V2"</span>, <span class="st">"V1"</span>, <span class="st">"V2"</span>, <span class="st">"V2"</span>, <span class="st">"V1"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    AVAL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">11</span>, <span class="fl">12</span>, <span class="fl">21</span>, <span class="fl">22</span>, <span class="fl">31</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="st">"adsl"</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    SUBJID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    WEIGHT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>    SEX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"U"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    COUNTRY <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DE"</span>, <span class="st">"US"</span>, <span class="st">"DE"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="va">example_dataset</span><span class="op">[[</span><span class="st">"adsl"</span><span class="op">]</span><span class="op">]</span>, rownames <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"filter":"none","vertical":false,"data":[["1","2","3"],[10,20,30],["M","F","U"],["DE","US","DE"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>SUBJID<\/th>\n      <th>WEIGHT<\/th>\n      <th>SEX<\/th>\n      <th>COUNTRY<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":1},{"name":"SUBJID","targets":0},{"name":"WEIGHT","targets":1},{"name":"SEX","targets":2},{"name":"COUNTRY","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="va">example_dataset</span><span class="op">[[</span><span class="st">"adbm"</span><span class="op">]</span><span class="op">]</span>, rownames <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"filter":"none","vertical":false,"data":[["1","1","2","2","3","3"],["PC1","PC2","PC1","PC2","PC1","PC2"],["P1","P2","P1","P2","P1","P2"],["V1","V2","V1","V2","V2","V1"],[11,12,21,22,31,3]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>SUBJID<\/th>\n      <th>PARCAT1<\/th>\n      <th>PARAM<\/th>\n      <th>AVISIT<\/th>\n      <th>AVAL<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":4},{"name":"SUBJID","targets":0},{"name":"PARCAT1","targets":1},{"name":"PARAM","targets":2},{"name":"AVISIT","targets":3},{"name":"AVAL","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="section level2">
<h2 id="module-features-using-example">Module Features using Example<a class="anchor" aria-label="anchor" href="#module-features-using-example"></a>
</h2>
<p>An app containing only the WfpHm module can be created using the
below code. The example dataset created above is used as the input
dataset for this app.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">module_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"WFPHM"</span> <span class="op">=</span> <span class="fu">dv.explorer.parameter</span><span class="fu">::</span><span class="fu"><a href="../reference/wfphm.html">mod_wfphm</a></span><span class="op">(</span></span>
<span>    module_id <span class="op">=</span> <span class="st">"wfphm"</span>,</span>
<span>    bm_dataset_name <span class="op">=</span> <span class="st">"adbm"</span>,</span>
<span>    group_dataset_name <span class="op">=</span> <span class="st">"adsl"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dv.manager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dv.manager/man/run_app.html" class="external-link">run_app</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>DS <span class="op">=</span> <span class="va">example_dataset</span><span class="op">)</span>,</span>
<span>  module_list <span class="op">=</span> <span class="va">module_list</span>,</span>
<span>  filter_data <span class="op">=</span> <span class="st">"adsl"</span>,</span>
<span>  filter_key <span class="op">=</span> <span class="st">"SUBJID"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="menus">Menus<a class="anchor" aria-label="anchor" href="#menus"></a>
</h3>
<p>Each plot in the module is driven by selections made under the
corresponding menu at the top. Various options to select the variables
to be plotted are available from the menu.</p>
<p><img src="images%2Fmenu2.png" style="width:100.0%"></p>
<p>Menus in this module are data-driven when possible, this means that
their content changes depending on the content of the dataset.</p>
<p>Let’s review each plot and its respective menu to see what are their
contents and how they relate to the dataset.</p>
</div>
<div class="section level3">
<h3 id="waterfall-plot">Waterfall plot<a class="anchor" aria-label="anchor" href="#waterfall-plot"></a>
</h3>
<p>This plot shows a bar chart representing the value of a variable per
subject in the adbm dataset in descending order. The variable shown in
the plot is selected from the waterfall menu option</p>
<div class="section level4">
<h4 id="plotting-columns">Plotting columns<a class="anchor" aria-label="anchor" href="#plotting-columns"></a>
</h4>
<div style="display: flex;">
<div>
<p><img src="images%2Fwf_value_col.png" style="width:50.0%"></p>
</div>
<div>
<p><img src="images%2Fwf_grouping_col.png" style="width:50.0%"></p>
</div>
</div>
<p>Dropdown menus for this plot are filled up the following way:</p>
<ul>
<li>The <em>Value</em> dropdown will contain all the columns in the bm
dataset that are numerical</li>
<li>The <em>Grouping</em> dropdown will contain all the columns in the
group dataset that are categorical</li>
</ul>
<p>As per the selections made in the screenshot above:</p>
<ul>
<li>The height of the bar in the chart represent the value of the
<em>WEIGHT</em> variable for each participant</li>
<li>Each bar is colored and labelled according to the <em>SUBJID</em>.
We can change this selection for a more meaningful one, for example
<em>COUNTRY</em>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="plotting-parameters">Plotting parameters<a class="anchor" aria-label="anchor" href="#plotting-parameters"></a>
</h4>
<p>The <a href="https://www.cdisc.org/kb/examples/adam-basic-data-structure-bds-using-paramcd-80288192" class="external-link">ADaM
Basic Data Structure (BDS) using PARAMCD</a> is used to store parameter
values for a given subject across several visits. Any of these
parameters can also be selected to be plotted in the waterfall. To do so
the <em>“Use Parameters”</em> check box in the menu should be
checked.</p>
<div style="display: flex;">
<div>
<p><img src="images%2Fwf_cat_param.png" style="width:75.0%"></p>
</div>
<div>
<p><img src="images%2Fwf_par_param.png" style="width:75.0%"></p>
</div>
<div>
<p><img src="images%2Fwf_visit_param.png" style="width:75.0%"></p>
</div>
</div>
<p>Checking the <em>“Use Parameter”</em> box at the top of the menu
changes the set of avaliable dropdown menus.</p>
<p>Dropdown menus are filled up in the following way:</p>
<ul>
<li>The <em>Category</em> dropdown will contain all the factor levels in
the <em>PARCAT1</em> column.</li>
<li>The <em>Parameter</em> dropdown will contain all the factor levels
in the <em>PARAM</em> column whose corresponding <em>PARCAT1</em> is
selected in the <em>Category</em> menu.</li>
<li>The <em>Value</em> dropdown will contain a subset of the numerical
columns in the dataset. We will cover this menu in a subsequent
section.</li>
<li>The <em>Visit</em> dropdown will contain all the factor levels in
the <em>AVISIT</em> column.</li>
</ul>
<p>According to the selections made in the screenshot:</p>
<ul>
<li>The height of the bar will represent the value of:
<ul>
<li>the <em>P1</em> parameter which is listed under the <em>PC1</em>
category</li>
<li>as listed in the <em>AVAL</em> column</li>
<li>for the visit <em>V1</em>
</li>
<li>for each participant</li>
</ul>
</li>
<li>As in the previous section, each bar is colored and labelled
according to the <em>SUBJID</em>
</li>
<li>A gray line is shown for participant 3 value because that particular
<em>Parameter</em>, <em>Visit</em>, <em>Value</em> combination is
missing</li>
</ul>
<p><img src="images%2Fwf_app_param.png" style="width:100.0%"></p>
</div>
<div class="section level4">
<h4 id="the-value-dropdown">The Value Dropdown<a class="anchor" aria-label="anchor" href="#the-value-dropdown"></a>
</h4>
<p>Plotting parameters requires selecting the numerical columns that
represent the parameter values, usually <em>AVAL</em> represents the raw
value. But deriving new values is quite common for example <em>Change
from Baseline</em> or transformation of the value such as
logarithms.</p>
<p>By default, the module have a list of common parameter value columns
that, if present in the dataset, will appear in the menu (e.g.: “AVAL”,
“CHG” or “PCHG”. See <code><a href="../reference/wfphm_server.html">dv.explorer.parameter::wfphm_server</a></code>
for a full list)</p>
<p>But if a custom column is derived we can modify the call to the
module so it is included in the menu as seen in the example below.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Lets create a new custom</span></span>
<span><span class="va">example_dataset_custom_aval</span> <span class="op">&lt;-</span> <span class="va">example_dataset</span></span>
<span><span class="va">example_dataset_custom_aval</span><span class="op">[[</span><span class="st">"adbm"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"CUSTOM_AVAL"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">example_dataset_custom_aval</span><span class="op">[[</span><span class="st">"adbm"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"AVAL"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fl">100</span></span>
<span></span>
<span><span class="va">module_list_custom_aval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"WFPHM"</span> <span class="op">=</span> <span class="fu">dv.explorer.parameter</span><span class="fu">::</span><span class="fu"><a href="../reference/wfphm.html">mod_wfphm</a></span><span class="op">(</span></span>
<span>    module_id <span class="op">=</span> <span class="st">"wfphm"</span>,</span>
<span>    value_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CUSTOM_AVAL"</span><span class="op">)</span>, <span class="co"># We have added this argument</span></span>
<span>    bm_dataset_name <span class="op">=</span> <span class="st">"adbm"</span>,</span>
<span>    group_dataset_name <span class="op">=</span> <span class="st">"adsl"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">dv.manager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dv.manager/man/run_app.html" class="external-link">run_app</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>DS <span class="op">=</span> <span class="va">example_dataset_custom_aval</span><span class="op">)</span>,</span>
<span>  module_list <span class="op">=</span> <span class="va">module_list_custom_aval</span>,</span>
<span>  filter_data <span class="op">=</span> <span class="st">"adbm"</span>,</span>
<span>  filter_key <span class="op">=</span> <span class="st">"SUBJID"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="images%2Fwf_custom_aval_param_1.png" style="width:25.0%"></p>
<p>The new argument in the module call indicates that
<em>CUSTOM_AVAL</em> is a column that contains values associated to
parameters and is therefore included in the menu. The previous
<em>AVAL</em> no longer appear in the menu, that happens because
specifying a new column overrides the default columns. If one is
specified then all should be specified.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">module_list_custom_aval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"WFPHM"</span> <span class="op">=</span> <span class="fu">dv.explorer.parameter</span><span class="fu">::</span><span class="fu"><a href="../reference/wfphm.html">mod_wfphm</a></span><span class="op">(</span></span>
<span>    module_id <span class="op">=</span> <span class="st">"wfphm"</span>,</span>
<span>    value_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AVAL"</span>, <span class="st">"CUSTOM_AVAL"</span><span class="op">)</span>, <span class="co"># We have added this argument</span></span>
<span>    bm_dataset_name <span class="op">=</span> <span class="st">"adbm"</span>,</span>
<span>    group_dataset_name <span class="op">=</span> <span class="st">"adsl"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dv.manager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dv.manager/man/run_app.html" class="external-link">run_app</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>DS <span class="op">=</span> <span class="va">example_dataset_custom_aval</span><span class="op">)</span>,</span>
<span>  module_list <span class="op">=</span> <span class="va">module_list_custom_aval</span>,</span>
<span>  filter_data <span class="op">=</span> <span class="st">"adbm"</span>,</span>
<span>  filter_key <span class="op">=</span> <span class="st">"SUBJID"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="images%2Fwf_custom_aval_param_2.png" style="width:25.0%"></p>
</div>
</div>
<div class="section level3">
<h3 id="outliers-menu">Outliers menu<a class="anchor" aria-label="anchor" href="#outliers-menu"></a>
</h3>
<p>At the bottom of the waterfall menu we can define which values are
considered outliers. The outliers will be colored in gray and labelled
accordingly.</p>
<p><img src="images%2Fwf_outlier_param.png" style="width:100.0%"></p>
</div>
<div class="section level3">
<h3 id="continuous-and-categorical-heatmap">Continuous and categorical heatmap<a class="anchor" aria-label="anchor" href="#continuous-and-categorical-heatmap"></a>
</h3>
<p>The two plots immediately below the waterfall plot are the
categorical and a continuous heatmaps.</p>
<div class="section level4">
<h4 id="categorical-heatmap">Categorical heatmap<a class="anchor" aria-label="anchor" href="#categorical-heatmap"></a>
</h4>
<p>Dropdown menu is filled up the following way:</p>
<ul>
<li>The <em>Categorical</em> dropdown will contain all the columns in
the group dataset that are categorical</li>
</ul>
<p>As per the selections made in the screenshot:</p>
<ul>
<li>In the first row the value of the column <em>SEX</em> for each
participant is displayed where each cell is labelled and colored
accordingly.</li>
<li>In the second row the value of the column <em>COUNTRY</em> for each
participant is displayed where each cell is labelled and colored
accordingly.</li>
</ul>
<p><img src="images%2Fcc_cat.png" style="width:100.0%"></p>
</div>
<div class="section level4">
<h4 id="continuous-heatmap">Continuous heatmap<a class="anchor" aria-label="anchor" href="#continuous-heatmap"></a>
</h4>
<p>Dropdown menus is filled up the following way:</p>
<ul>
<li>The <em>Continuous</em> dropdown will contain all the columns in the
group dataset that are numerical</li>
</ul>
<p>As per the selections made in the screenshot:</p>
<ul>
<li>In the first row the value of the column <em>WEIGHT</em> for each
participant is displayed where each cell is labelled and colored
accordingly</li>
</ul>
<p><img src="images%2Fcc_cont.png" style="width:100.0%"></p>
</div>
</div>
<div class="section level3">
<h3 id="parameter-heatmap">Parameter heatmap<a class="anchor" aria-label="anchor" href="#parameter-heatmap"></a>
</h3>
<p>The last plot is the parameter heatmap that plots a heatmap where the
rows represent different parameters.</p>
<p>The menus in this plot follow similar rules to those presented in the
Plotting Parameter section in the Waterfall plot with the difference
that the <em>Category</em> and <em>Parameter</em> menus now accept
selecting multiple values. The <em>Transformation</em> menu will be
covered in a separate section below.</p>
<p><img src="images%2Fhmpar_app.png" style="width:100.0%"></p>
<p>Therefore according to the present selection we are observing:</p>
<ul>
<li>In the first row the color of the cell represents the value of:
<ul>
<li>the <em>P1</em> parameter which is listed under the <em>PC1</em>
category</li>
<li>as listed in the <em>AVAL</em> column</li>
<li>for the visit <em>V1</em>
</li>
<li>for each participant</li>
</ul>
</li>
<li>In the second row the color of the cell represents the value of:
<ul>
<li>the <em>P2</em> parameter which is listed under the <em>PC2</em>
category</li>
<li>as listed in the <em>AVAL</em> column</li>
<li>for the visit <em>V1</em>
</li>
<li>for each participant</li>
</ul>
</li>
<li>Missing values are grayed out</li>
</ul>
</div>
<div class="section level3">
<h3 id="outlier-menu">Outlier menu<a class="anchor" aria-label="anchor" href="#outlier-menu"></a>
</h3>
<p>The parameter heatmap works similarly to that described in the
Waterfall plot with the only difference that, because several
parameteres can be shown in this heatmap, a different outlier range can
be defined for each parameter.</p>
<div class="section level4">
<h4 id="the-transformation-dropdown-menu">The Transformation Dropdown Menu<a class="anchor" aria-label="anchor" href="#the-transformation-dropdown-menu"></a>
</h4>
<p>The transformation menu offers several possible data transformation
such as Z-score or Min-Max. The transformation is applied to each
parameter (i.e. to each row of the heatmap) independently.</p>
<div style="padding: 1em 1em 1em 1em;  margin-bottom: 5px;  border: 1px solid #64a1ce;  border-radius: 5px;  background:#f5f5f5 5px center/3em no-repeat;">
<p><img src="images%2FNote.png" style="width:4.0%"><strong>Note</strong> Outliers definition, described in the previous
section, does not affect the calculation of the transformations</p>
</div>
<p><br></p>
<p><img src="images%2Fhmpar_transformation.png" style="width:25.0%"></p>
<p>By default, the module include several transformation (See
<code><a href="../reference/wfphm_server.html">dv.explorer.parameter::wfphm_server</a></code> for a full list) but
the user can include custom transformations if needed for their data.
The function is applied to each row independently, meaning the function
receives a vector with all the values from a row and it must returned a
similar vector with the transformed values.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">module_list_custom_transformation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="co"># nolint</span></span>
<span>  <span class="st">"WFPHM"</span> <span class="op">=</span> <span class="fu">dv.explorer.parameter</span><span class="fu">::</span><span class="fu"><a href="../reference/wfphm.html">mod_wfphm</a></span><span class="op">(</span></span>
<span>    module_id <span class="op">=</span> <span class="st">"wfphm"</span>,</span>
<span>    tr_mapper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="co"># New argument</span></span>
<span>      <span class="st">"Original"</span> <span class="op">=</span> <span class="fu">dv.explorer.parameter</span><span class="fu">::</span><span class="va"><a href="../reference/transformation.html">tr_identity</a></span>,</span>
<span>      <span class="st">"Mean Centered"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">)</span>,</span>
<span>    bm_dataset_name <span class="op">=</span> <span class="st">"adbm"</span>,</span>
<span>    group_dataset_name <span class="op">=</span> <span class="st">"adsl"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dv.manager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dv.manager/man/run_app.html" class="external-link">run_app</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>DS <span class="op">=</span> <span class="va">example_dataset</span><span class="op">)</span>,</span>
<span>  module_list <span class="op">=</span> <span class="va">module_list_custom_transformation</span>,</span>
<span>  filter_data <span class="op">=</span> <span class="st">"adbm"</span>,</span>
<span>  filter_key <span class="op">=</span> <span class="st">"SUBJID"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="images%2Fhmpar_transformation_custom.png" style="width:25.0%"></p>
</div>
</div>
<div class="section level3">
<h3 id="using-column-labels-in-the-menus">Using column labels in the menus<a class="anchor" aria-label="anchor" href="#using-column-labels-in-the-menus"></a>
</h3>
<p>When the menu entries reference a column in the dataset, we can
decorate the entries by setting a label attribute for the columns.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assign some labels to the dataset</span></span>
<span><span class="va">example_dataset_labelled</span> <span class="op">&lt;-</span> <span class="va">example_dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">example_dataset_labelled</span><span class="op">[[</span><span class="st">"adbm"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"SUBJID"</span><span class="op">]</span><span class="op">]</span>, <span class="st">"label"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Subject ID"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">example_dataset_labelled</span><span class="op">[[</span><span class="st">"adbm"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"SEX"</span><span class="op">]</span><span class="op">]</span>, <span class="st">"label"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Subject Sex"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">example_dataset_labelled</span><span class="op">[[</span><span class="st">"adbm"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"PARCAT1"</span><span class="op">]</span><span class="op">]</span>, <span class="st">"label"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Parameter Category"</span></span>
<span></span>
<span><span class="fu">dv.manager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dv.manager/man/run_app.html" class="external-link">run_app</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>DS <span class="op">=</span> <span class="va">example_dataset_labelled</span><span class="op">)</span>,</span>
<span>  module_list <span class="op">=</span> <span class="va">module_list</span>,</span>
<span>  filter_data <span class="op">=</span> <span class="st">"adbm"</span>,</span>
<span>  filter_key <span class="op">=</span> <span class="st">"SUBJID"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="custom-column-names">Custom column names<a class="anchor" aria-label="anchor" href="#custom-column-names"></a>
</h3>
<p>As mentioned described in the previous section, though this module is
designed to work with <a href="https://www.cdisc.org/kb/examples/adam-basic-data-structure-bds-using-paramcd-80288192" class="external-link">ADaM
Basic Data Structure (BDS) using PARAMCD</a>, it can also be used
generally with non-standard datasets that have a similar structure.</p>
<p>For example, consider the below example where a dataset with
different column names is created and used for a app with this module.
As you can notice, the non standard column names are used as the values
for applicable module arguments.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adbm_dataset</span> <span class="op">&lt;-</span> <span class="fu">dv.explorer.parameter</span><span class="fu">:::</span><span class="fu">safety_data</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="st">"bm"</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    USUBJID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span>,</span>
<span>    PARCAT1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">PARCAT1</span><span class="op">)</span>,</span>
<span>    PARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">PARAM</span><span class="op">)</span>,</span>
<span>    AVISIT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">AVISIT</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">adsl_dataset</span> <span class="op">&lt;-</span> <span class="fu">dv.explorer.parameter</span><span class="fu">:::</span><span class="fu">safety_data</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="st">"sl"</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>USUBJID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">module_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"WFPHM"</span> <span class="op">=</span> <span class="fu">dv.explorer.parameter</span><span class="fu">::</span><span class="fu"><a href="../reference/wfphm.html">mod_wfphm</a></span><span class="op">(</span></span>
<span>    module_id <span class="op">=</span> <span class="st">"wfphm"</span>,</span>
<span>    bm_dataset_name <span class="op">=</span> <span class="st">"adbm"</span>,</span>
<span>    group_dataset_name <span class="op">=</span> <span class="st">"adsl"</span>,</span>
<span>    cat_var <span class="op">=</span> <span class="st">"PARCAT1"</span>,</span>
<span>    par_var <span class="op">=</span> <span class="st">"PARAM"</span>,</span>
<span>    visit_var <span class="op">=</span> <span class="st">"AVISIT"</span>,</span>
<span>    subjid_var <span class="op">=</span> <span class="st">"USUBJID"</span>,</span>
<span>    value_vars <span class="op">=</span> <span class="st">"AVAL"</span>,</span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dv.manager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dv.manager/man/run_app.html" class="external-link">run_app</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dummy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adbm <span class="op">=</span> <span class="va">adbm_dataset</span>, adsl <span class="op">=</span> <span class="va">adsl_dataset</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  module_list <span class="op">=</span> <span class="va">module_list</span>,</span>
<span>  filter_data <span class="op">=</span> <span class="st">"adsl"</span>,</span>
<span>  filter_key <span class="op">=</span> <span class="st">"USUBJID"</span> <span class="co"># We changed this one too, see dv.manager filtering doc for this change</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Boehringer-Ingelheim Pharma GmbH &amp; Co.KG, Luis Moris Fernandez, Miguel Lechon.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
